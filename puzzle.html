<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸŽƒ Halloween Image Puzzle</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Load PyScript -->
    <!-- PyScript removed for static hosting (was printing code on Go Live) -->

  <style>
    body {
      background: #fff;
      color: #111;
    }
    .puzzle-container {
      display: grid;
      margin: 20px auto;
      border: 2px solid #333;
      position: relative; /* for absolute-positioned animation clones */
    }
    .preview {
      width: 160px;
      height: 160px;
      margin: 10px auto 0;
      background-size: cover;
      border: 2px solid #ccc;
      border-radius: 6px;
    }
    .puzzle-area{
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:24px;
      margin-top: 8px;
    }
    @media (max-width: 800px){
      .puzzle-area{flex-direction:column-reverse; align-items:center}
      .preview{margin-top:8px}
      .puzzle-container { transform: scale(0.95); }
    }
    .tile {
      width: 200px;
      height: 200px;
      background-size: 600px 600px; /* full image size = size Ã— tile size (3 Ã— 200) */
      background-repeat: no-repeat;
      border: 1px solid #222;
      cursor: pointer;
    }
    .empty {
      background: #fff;
      cursor: default;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.08);
    }
    #invite {
      margin-top: 20px;
      text-align: center;
      display: none;
    }
    #invite img {
      max-width: 100%;
      border: 3px solid #333;
      border-radius: 10px;
    }
    #controls {
      text-align: center;
      margin-top: 15px;
    }
    button {
      background: orange;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: darkorange;
    }
    input.invalid { border-color: #e44; box-shadow: 0 0 6px rgba(228,68,68,0.15); }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="title">ðŸŽƒ Halloween Image Puzzle</h1>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="projects.html">Projects</a>
        <a href="blog.html">Blogs</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="section container">
  <h2>Halloween is approaching, for the annual Halloween party, Solve the puzzle to reveal your invitation. If you want to pass, type in the password sent with the invitation link.</h2>
  <div class="puzzle-area">
    <div id="puzzle" class="puzzle-container"></div>
    <div id="preview" class="preview" aria-hidden="true" style="background-image: url('other_files/puzzle_image_600.jpg')"></div>
  </div>
    <div id="controls">
      <button id="reset-btn">ðŸ”„ Reset Puzzle</button>
      <div style="display:inline-block; margin-left:12px; vertical-align:middle">
        <input id="pass-input" placeholder="Enter pass" aria-label="pass input" style="padding:6px 8px; border-radius:4px; border:1px solid #ccc;" />
        <button id="pass-btn" style="margin-left:6px;">Pass</button>
        <span id="pass-msg" aria-live="polite" style="margin-left:8px; color:#e44; font-size:14px; min-width:120px; display:inline-block"></span>
      </div>
    </div>
    <div id="invite">
      <h2>ðŸŽ‰ You solved it! Hereâ€™s your invitation:</h2>
  <img src="other_files/Invite.jpg" alt="Halloween Invitation" />
    
    <div id="rsvp" style="display:none; margin-top:16px;">
      <h3>RSVP</h3>
      <p>Please let us know your name and how many people will attend (including you).</p>
      <form id="rsvp-form">
        <div>
          <label>Name: <input id="rsvp-name" required /></label>
        </div>
        <div style="margin-top:8px">
          <label>Number of guests: <input id="rsvp-count" type="number" min="1" value="1" required style="width:80px; margin-left:8px" /></label>
        </div>
        <div style="margin-top:8px">
          <button type="submit">Send RSVP</button>
        </div>
      </form>
      <p id="rsvp-note" style="color:green; display:none;">RSVP prepared â€” your email client should open.</p>
    </div>
    </div>
  </main>
    <script>
    (function(){
  const size = 3;
  const tileSize = 200;
  const imageUrl = 'other_files/puzzle_image_600.jpg';
  let tiles = Array.from({length: size*size - 1}, (_,i) => i).concat([null]);

      function isSolvable(seq){
        let inv = 0;
        const arr = seq.filter(x => x !== null);
        for(let i=0;i<arr.length;i++){
          for(let j=i+1;j<arr.length;j++){
            if(arr[i] > arr[j]) inv++;
          }
        }
        const emptyRow = Math.floor(seq.indexOf(null)/size);
        return ((inv + emptyRow) % 2) === 0;
      }

      function shuffle(){
        do{
          for(let i=tiles.length-1;i>0;i--){
            const j = Math.floor(Math.random()*(i+1));
            [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
          }
        }while(!isSolvable(tiles));
      }

      function render(){
        const puzzle = document.getElementById('puzzle');
        puzzle.style.gridTemplateColumns = `repeat(${size}, ${tileSize}px)`;
        puzzle.style.gridTemplateRows = `repeat(${size}, ${tileSize}px)`;
        puzzle.innerHTML = '';
        tiles.forEach((val, i) => {
          const div = document.createElement('div');
          if(val === null){
            div.className = 'tile empty';
            div.style.pointerEvents = 'none';
          } else {
            div.className = 'tile';
            const row = Math.floor(val / size);
            const col = val % size;
            div.style.backgroundImage = `url('${imageUrl}')`;
            div.style.backgroundPosition = `-${col*tileSize}px -${row*tileSize}px`;
            div.style.transform = 'none';
            div.addEventListener('click', () => move(i));
          }
          puzzle.appendChild(div);
        });
      }

      let animating = false;

      function animateTileMove(fromEl, toRect, duration=260){
        return new Promise((resolve)=>{
          const clone = fromEl.cloneNode(true);
          const fromRect = fromEl.getBoundingClientRect();
          const containerRect = document.getElementById('puzzle').getBoundingClientRect();
          clone.style.position = 'absolute';
          clone.style.left = (fromRect.left - containerRect.left) + 'px';
          clone.style.top = (fromRect.top - containerRect.top) + 'px';
          clone.style.margin = '0';
          clone.style.transition = `transform ${duration}ms ease`;
          clone.style.zIndex = 1000;
          document.getElementById('puzzle').appendChild(clone);
          const dx = (toRect.left - fromRect.left);
          const dy = (toRect.top - fromRect.top);
          requestAnimationFrame(()=>{
            clone.style.transform = `translate(${dx}px, ${dy}px)`;
          });
          setTimeout(()=>{ try{ clone.remove(); }catch(e){}; resolve(); }, duration+20);
        });
      }

      async function move(idx){
        if(animating) return;
        const emptyIdx = tiles.indexOf(null);
        const r1 = Math.floor(idx/size), c1 = idx%size;
        const r2 = Math.floor(emptyIdx/size), c2 = emptyIdx%size;
        if(Math.abs(r1-r2)+Math.abs(c1-c2) === 1){
          animating = true;
          // find DOM elements for the tile and empty slot
          const puzzleEl = document.getElementById('puzzle');
          const children = Array.from(puzzleEl.children);
          const fromEl = children[idx];
          const toEl = children[emptyIdx];
          const fromRect = fromEl.getBoundingClientRect();
          const toRect = toEl.getBoundingClientRect();
          await animateTileMove(fromEl, toRect);
          // perform logical swap
          [tiles[emptyIdx], tiles[idx]] = [tiles[idx], tiles[emptyIdx]];
          render();
          animating = false;
          checkWin();
        }
      }

      function checkWin(){
        const win = Array.from({length: size*size-1}, (_,i)=>i).concat([null]);
        if(tiles.every((v,i)=>v===win[i])){
          playWinSound();
          document.getElementById('invite').style.display = 'block';
          const rsvpEl = document.getElementById('rsvp');
          if(rsvpEl){
            rsvpEl.style.display = 'block';
            rsvpEl.scrollIntoView({behavior:'smooth', block:'center'});
            const nameInput = document.getElementById('rsvp-name');
            if(nameInput){ nameInput.focus(); }
          }
        }
      }

      function playWinSound(){
        try{
          const C = window.AudioContext || window.webkitAudioContext;
          if(!C) return;
          const ctx = new C();
          const now = ctx.currentTime;

          // Primary rising tone
          const o1 = ctx.createOscillator();
          const g1 = ctx.createGain();
          o1.type = 'sine';
          o1.frequency.setValueAtTime(660, now);
          o1.frequency.exponentialRampToValueAtTime(1320, now + 0.28);
          g1.gain.setValueAtTime(0.0001, now);
          g1.gain.linearRampToValueAtTime(0.16, now + 0.02);
          g1.gain.exponentialRampToValueAtTime(0.0001, now + 1.0);
          o1.connect(g1);
          g1.connect(ctx.destination);
          o1.start(now);
          o1.stop(now + 1.0);

          // Second gentle tone
          const o2 = ctx.createOscillator();
          const g2 = ctx.createGain();
          o2.type = 'triangle';
          o2.frequency.setValueAtTime(880, now + 0.06);
          o2.frequency.exponentialRampToValueAtTime(660, now + 0.5);
          g2.gain.setValueAtTime(0.0001, now + 0.06);
          g2.gain.linearRampToValueAtTime(0.12, now + 0.09);
          g2.gain.exponentialRampToValueAtTime(0.0001, now + 0.9);
          o2.connect(g2);
          g2.connect(ctx.destination);
          o2.start(now + 0.06);
          o2.stop(now + 0.9);

          // Close the AudioContext after tones finish to free resources
          setTimeout(()=>{ try{ ctx.close(); }catch(e){} }, 1200);
        }catch(e){
          console.warn('Audio playback failed', e);
        }
      }

      // Hook up reset button
      const resetBtn = document.getElementById('reset-btn');
      if(resetBtn){
          resetBtn.addEventListener('click', () => {
            shuffle();
            render();
            document.getElementById('invite').style.display = 'none';
            // hide RSVP when resetting
            const rsvpEl = document.getElementById('rsvp');
            if(rsvpEl){ rsvpEl.style.display = 'none'; }
            if(passInput){ passInput.value = ''; }
            const passMsg = document.getElementById('pass-msg');
            if(passMsg){ passMsg.textContent = ''; }
        });
      }

      // Pass button: allow bypass with secret word
      const passInput = document.getElementById('pass-input');
      const passBtn = document.getElementById('pass-btn');
        function tryPass(){
          const val = (passInput && passInput.value || '').trim().toLowerCase();
          const passMsg = document.getElementById('pass-msg');
          if(val === 'daisy'){
              playWinSound();
              document.getElementById('invite').style.display = 'block';
              if(passMsg){ passMsg.textContent = ''; }
              const rsvpEl = document.getElementById('rsvp');
              if(rsvpEl){
                rsvpEl.style.display = 'block';
                rsvpEl.scrollIntoView({behavior:'smooth', block:'center'});
                const nameInput = document.getElementById('rsvp-name');
                if(nameInput){ nameInput.focus(); }
              }
          } else {
            if(passMsg){ passMsg.textContent = 'Wrong password'; }
            if(passInput){
              passInput.classList.add('invalid');
              setTimeout(()=> passInput && passInput.classList.remove('invalid'), 600);
              setTimeout(()=> passMsg && (passMsg.textContent = ''), 1500);
            }
          }
        }
      if(passBtn){ passBtn.addEventListener('click', tryPass); }
      if(passInput){
        passInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ tryPass(); } });
        // focus for convenience
        passInput.focus();
      }

      // RSVP handling (mailto fallback)
  const hostEmail = 'daisy_huang1020@hotmail.com'; // real recipient email
      const rsvpForm = document.getElementById('rsvp-form');
      if(rsvpForm){
        rsvpForm.addEventListener('submit', (e)=>{
          e.preventDefault();
          const name = document.getElementById('rsvp-name').value || '';
          const count = document.getElementById('rsvp-count').value || '1';
          const subject = encodeURIComponent('RSVP from ' + name);
          const body = encodeURIComponent(`Name: ${name}%0ANumber of guests: ${count}`);
          const mailto = `mailto:${hostEmail}?subject=${subject}&body=${body}`;
          // Open user's email client
          window.location.href = mailto;
          const note = document.getElementById('rsvp-note');
          if(note){ note.style.display = 'block'; }
        });
      }

      // Initialize
      shuffle();
      render();
    })();
    </script>

  <footer class="footer">
    <p>Â© 2025 Daisy Huang</p>
  </footer>

  <!-- Removed PyScript block: page now uses a pure JavaScript implementation -->
</body>
</html>
